#include <catch2/catch.hpp>
#include <lib_math/lib_math.h>
#include <vector>

TEST_CASE("Test fit Gaussian curve", "[curve]")
{
    std::vector<Eigen::Vector2f> pts = {
        { 1.00, 0.000000 }, { 2.00, 0.158135 }, { 3.00, -0.700928 },
        { 4.00, -0.428596 }, { 5.00, 1.238742 }, { 6.00, -0.278008 },
        { 7.00, -0.648398 }, { 8.00, 0.305165 }, { 9.00, 0.515020 },
        { 10.00, -1.145033 }, { 11.00, 0.769870 }, { 12.00, -0.046378 },
        { 13.00, 1.306019 }, { 14.00, -1.959449 }, { 15.00, -1.898736 },
        { 16.00, -0.536284 }, { 17.00, -0.746425 }, { 18.00, 1.900064 },
        { 19.00, 0.280756 }, { 20.00, -1.367864 }, { 21.00, 1.558812 },
        { 22.00, -0.746990 }, { 23.00, -2.406627 }, { 24.00, -1.432001 },
        { 25.00, -1.172974 }, { 26.00, 0.251864 }, { 27.00, 1.855836 },
        { 28.00, 1.589814 }, { 29.00, 0.952611 }, { 30.00, 1.310558 },
        { 31.00, 4.538164 }, { 32.00, 4.282929 }, { 33.00, 6.849646 },
        { 34.00, 7.088934 }, { 35.00, 9.678623 }, { 36.00, 15.160442 },
        { 37.00, 18.500130 }, { 38.00, 23.415051 }, { 39.00, 29.665291 },
        { 40.00, 36.419178 }, { 41.00, 45.535393 }, { 42.00, 53.203758 },
        { 43.00, 61.152809 }, { 44.00, 70.795631 }, { 45.00, 77.132729 },
        { 46.00, 84.605721 }, { 47.00, 91.180420 }, { 48.00, 97.240318 },
        { 49.00, 97.033440 }, { 50.00, 100.697937 }, { 51.00, 98.788498 },
        { 52.00, 96.176956 }, { 53.00, 91.655815 }, { 54.00, 84.376945 },
        { 55.00, 78.529076 }, { 56.00, 69.598335 }, { 57.00, 62.927597 },
        { 58.00, 52.442574 }, { 59.00, 43.684135 }, { 60.00, 37.497585 },
        { 61.00, 30.413763 }, { 62.00, 24.379061 }, { 63.00, 17.965630 },
        { 64.00, 13.505819 }, { 65.00, 10.664560 }, { 66.00, 6.772091 },
        { 67.00, 4.599497 }, { 68.00, 5.087188 }, { 69.00, 3.351198 }
    };
    /* The reference parameters is 
     * float a = 100.0, mu = 50.0, sigma = 10.0/sqrt(2); */
    mmath::GaussianCurve gauss = mmath::fitGuassianCurve(pts);
    CHECK(gauss.a == Approx(99.895340).margin(1e-5));
    CHECK(gauss.mu == Approx(50.002186).margin(1e-5));
    CHECK(gauss.sigma == Approx(7.091824).margin(1e-5));
}
